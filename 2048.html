<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>www.google.com</title>
<style>
body { font-family:sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; background:#faf8ef; }
#game-container { display:grid; grid-template-columns:repeat(4,80px); grid-gap:10px; background:#bbada0; padding:10px; border-radius:10px; }
.tile { width:80px; height:80px; display:flex; justify-content:center; align-items:center; font-size:24px; font-weight:bold; border-radius:6px; color:#776e65; }
.tile-2 { background:#eee4da; }
.tile-4 { background:#ede0c8; }
.tile-8 { background:#f2b179; color:#fff; }
.tile-16 { background:#f59563; color:#fff; }
.tile-32 { background:#f67c5f; color:#fff; }
.tile-64 { background:#f65e3b; color:#fff; }
.tile-128 { background:#edcf72; color:#fff; font-size:20px; }
.tile-256 { background:#edcc61; color:#fff; font-size:20px; }
.tile-512 { background:#edc850; color:#fff; font-size:20px; }
.tile-1024 { background:#edc53f; color:#fff; font-size:16px; }
.tile-2048 { background:#edc22e; color:#fff; font-size:16px; }
</style>
</head>
<body>
<div id="game-container"></div>

<script>
const size = 4;
let board = [];
const container = document.getElementById('game-container');

function initBoard(){
  board = Array.from({length:size},()=>Array(size).fill(0));
  addRandomTile();
  addRandomTile();
  renderBoard();
}

function renderBoard(){
  container.innerHTML = '';
  for(let i=0;i<size;i++){
    for(let j=0;j<size;j++){
      const div = document.createElement('div');
      div.className = 'tile' + (board[i][j]? ` tile-${board[i][j]}`:'');
      div.textContent = board[i][j] || '';
      container.appendChild(div);
    }
  }
}

function addRandomTile(){
  const empty = [];
  for(let i=0;i<size;i++){
    for(let j=0;j<size;j++){
      if(board[i][j]===0) empty.push([i,j]);
    }
  }
  if(empty.length===0) return;
  const [r,c] = empty[Math.floor(Math.random()*empty.length)];
  board[r][c] = Math.random()<0.9?2:4;
}

function move(dir){
  let moved=false;
  let merged = Array.from({length:size},()=>Array(size).fill(false));
  const rotate = (b)=>{
    const newB = Array.from({length:size},()=>Array(size).fill(0));
    for(let i=0;i<size;i++) for(let j=0;j<size;j++) newB[i][j]=b[j][i];
    return newB;
  };
  const reverse = (b)=>b.map(row=>row.slice().reverse());

  let b = board.map(row=>row.slice());
  if(dir==='up'){ b = rotate(b); }
  if(dir==='down'){ b = rotate(b); b = reverse(b); }
  if(dir==='right'){ b = b.map(row=>row.slice().reverse()); }

  for(let i=0;i<size;i++){
    for(let j=1;j<size;j++){
      if(b[i][j]===0) continue;
      let k=j;
      while(k>0 && b[i][k-1]===0){ b[i][k-1]=b[i][k]; b[i][k]=0; k--; moved=true; }
      if(k>0 && b[i][k-1]===b[i][k] && !merged[i][k-1] && !merged[i][k]){
        b[i][k-1]*=2; b[i][k]=0; merged[i][k-1]=true; moved=true;
      }
    }
  }

  if(dir==='up'){ b = rotate(b); b = rotate(b); b = rotate(b); }
  if(dir==='down'){ b = reverse(b); b = rotate(b); b = rotate(b); b = rotate(b); }
  if(dir==='right'){ b = b.map(row=>row.slice().reverse()); }

  if(moved){ board=b; addRandomTile(); renderBoard(); checkGameOver(); }
}

function checkGameOver(){
  for(let i=0;i<size;i++){
    for(let j=0;j<size;j++){
      if(board[i][j]===0) return;
      if(i<size-1 && board[i][j]===board[i+1][j]) return;
      if(j<size-1 && board[i][j]===board[i][j+1]) return;
    }
  }
  setTimeout(()=>alert('ゲームオーバー！'),50);
}

document.addEventListener('keydown', e=>{
  if(e.key==='ArrowUp') move('up');
  if(e.key==='ArrowDown') move('down');
  if(e.key==='ArrowLeft') move('left');
  if(e.key==='ArrowRight') move('right');
});

initBoard();
</script>
</body>
</html>
